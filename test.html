<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Excel Data Management</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
</head>
<body>
<div class="container mt-5">
  <h1 class="text-center mb-4">Marker and Resource ID Management</h1>

  <!-- Upload Excel -->
  <div class="mb-4">
    <input type="file" id="fileUpload" accept=".xlsx, .xls" class="form-control" />
  </div>

  <!-- Form Section -->
  <div class="card mb-4">
    <div class="card-body">
      <form id="dataForm">
        <div class="mb-3">
          <label for="markerId" class="form-label">Marker ID</label>
          <input type="text" class="form-control" id="markerId" required>
        </div>
        <div class="mb-3">
          <label for="resourceId" class="form-label">Resource ID</label>
          <input type="text" class="form-control" id="resourceId" required>
        </div>
        <button type="submit" class="btn btn-primary">Add Entry</button>
      </form>
    </div>
  </div>

  <!-- Data Table Section -->
  <div class="card">
    <div class="card-body">
      <h5 class="card-title">Saved Data</h5>
      <table class="table table-bordered" id="dataTable">
        <thead>
        <tr>
          <th>Marker ID</th>
          <th>Resource ID</th>
          <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        <!-- Dynamic Data Rows Will Be Inserted Here -->
        </tbody>
      </table>
      <button class="btn btn-success mt-3" id="downloadBtn">Download Excel</button>
    </div>
  </div>
</div>

<script>
  let data = [];

  // Load Excel data from uploaded file
  document.getElementById("fileUpload").addEventListener("change", function (event) {
    const file = event.target.files[0];
    const reader = new FileReader();
    reader.onload = function (e) {
      const workbook = XLSX.read(e.target.result, { type: "binary" });
      const firstSheetName = workbook.SheetNames[0];
      const sheet = workbook.Sheets[firstSheetName];
      data = XLSX.utils.sheet_to_json(sheet);
      renderTable();
    };
    reader.readAsBinaryString(file);
  });

  // Add data from form to the table and data array
  document.getElementById("dataForm").addEventListener("submit", function (event) {
    event.preventDefault();
    const markerId = document.getElementById("markerId").value;
    const resourceId = document.getElementById("resourceId").value;

    data.push({ markerId, resourceId });
    document.getElementById("markerId").value = '';
    document.getElementById("resourceId").value = '';
    renderTable();
  });

  // Render table with data
  function renderTable() {
    const tableBody = document.getElementById("dataTable").getElementsByTagName("tbody")[0];
    tableBody.innerHTML = '';

    data.forEach((item, index) => {
      const row = document.createElement("tr");

      const markerCell = document.createElement("td");
      markerCell.innerText = item.markerId;
      row.appendChild(markerCell);

      const resourceCell = document.createElement("td");
      resourceCell.innerText = item.resourceId;
      row.appendChild(resourceCell);

      const actionsCell = document.createElement("td");
      actionsCell.innerHTML = `
      <button class="btn btn-warning btn-sm" onclick="editEntry(${index})">Edit</button>
      <button class="btn btn-danger btn-sm" onclick="deleteEntry(${index})">Delete</button>
    `;
      row.appendChild(actionsCell);

      tableBody.appendChild(row);
    });
  }

  // Edit Entry Function
  function editEntry(index) {
    const entry = data[index];
    document.getElementById("markerId").value = entry.markerId;
    document.getElementById("resourceId").value = entry.resourceId;

    data.splice(index, 1);
    renderTable();
  }

  // Delete Entry Function
  function deleteEntry(index) {
    data.splice(index, 1);
    renderTable();
  }

  // Download Excel file with updated data
  document.getElementById("downloadBtn").addEventListener("click", function () {
    const worksheet = XLSX.utils.json_to_sheet(data);
    const workbook = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(workbook, worksheet, "Data");
    XLSX.writeFile(workbook, "updated_data.xlsx");
  });

</script>
</body>
</html>
