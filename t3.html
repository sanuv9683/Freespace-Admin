<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Device Data Manager</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>
<div class="container my-5">
  <h1 class="text-center mb-4">Device Data Manager</h1>

  <!-- Form to Enter Marker ID and Device ID -->
  <form id="dataForm" class="mb-4">
    <div class="row">
      <div class="col-md-5">
        <input type="text" id="markerId" class="form-control" placeholder="Enter Marker ID" required>
      </div>
      <div class="col-md-5">
        <input type="text" id="deviceId" class="form-control" placeholder="Enter Device ID" required>
      </div>
      <div class="col-md-2">
        <button type="button" class="btn btn-primary w-100" onclick="addData()">Add Entry</button>
      </div>
    </div>
  </form>

  <!-- Table to Display Data -->
  <table class="table table-striped" id="dataTable">
    <thead class="table-dark">
    <tr>
      <th>Marker ID</th>
      <th>Device ID</th>
      <th>Actions</th>
    </tr>
    </thead>
    <tbody id="dataBody">
    <!-- Data rows will be dynamically added here -->
    </tbody>
  </table>
</div>

<script>

  const CLIENT_ID = '936125713810-vllc3mt30976jfllsg3i40ak55lofvl1.apps.googleusercontent.com';
  const API_KEY = 'AIzaSyCsWAr78ZezVoY0xgLQj8K-K6dJuR_McSc';
  const SHEET_ID = '1Mifn_2UvP5N7cxY9p0guNeU97yDHGBTCRrdT9bXY-I8';
  const DISCOVERY_DOC = 'https://sheets.googleapis.com/$discovery/rest?version=v4';
  const SCOPES = 'https://www.googleapis.com/auth/spreadsheets';

  function handleClientLoad() {
    gapi.load('client:auth2', initClient);
  }

  function initClient() {
    gapi.client.init({
      apiKey: API_KEY,
      clientId: CLIENT_ID,
      discoveryDocs: [DISCOVERY_DOC],
      scope: SCOPES,
    }).then(() => {
      gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);
      updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
    });
  }

  function updateSigninStatus(isSignedIn) {
    if (isSignedIn) {
      fetchData();
    } else {
      gapi.auth2.getAuthInstance().signIn();
    }
  }

  function fetchData() {
    gapi.client.sheets.spreadsheets.values.get({
      spreadsheetId: SHEET_ID,
      range: 'Sheet1!A:B',
    }).then(response => {
      displayData(response.result.values);
    });
  }

  function addData() {
    const markerId = document.getElementById('markerId').value;
    const deviceId = document.getElementById('deviceId').value;

    gapi.client.sheets.spreadsheets.values.append({
      spreadsheetId: SHEET_ID,
      range: 'Sheet1!A:B',
      valueInputOption: 'RAW',
      resource: {
        values: [[markerId, deviceId]],
      },
    }).then(response => {
      fetchData();
      document.getElementById('dataForm').reset();
    });
  }

  window.onload = handleClientLoad;

</script>
</body>
</html>
